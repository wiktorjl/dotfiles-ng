#!/bin/bash
# py2desktop - Generate a .desktop file for a Python script

set -euo pipefail

if [[ $# -lt 1 ]]; then
    echo "Usage: py2desktop <path-to-python-file>"
    exit 1
fi

PYFILE="$1"

if [[ ! -f "$PYFILE" ]]; then
    echo "Error: File '$PYFILE' not found"
    exit 1
fi

# Get absolute path
PYFILE_ABS=$(realpath "$PYFILE")
PYFILE_DIR=$(dirname "$PYFILE_ABS")
PYFILE_NAME=$(basename "$PYFILE_ABS" .py)

# Capitalize first letter for Name
NAME="${PYFILE_NAME^}"

DESKTOP_DIR="$HOME/.local/share/applications"
DESKTOP_FILE="$DESKTOP_DIR/${PYFILE_NAME}.desktop"

mkdir -p "$DESKTOP_DIR"

cat > "$DESKTOP_FILE" << EOF
[Desktop Entry]
Type=Application
Name=$NAME
Comment=$NAME Python Application
Exec=/usr/bin/konsole --noclose --workdir $PYFILE_DIR -e /usr/bin/python3 $PYFILE_ABS
Icon=utilities-terminal
Categories=Utility;
Terminal=false
EOF

echo "Created: $DESKTOP_FILE"
